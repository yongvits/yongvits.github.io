<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>AR Image Tracking + Recorder</title>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.1.4/dist/mindar-image.prod.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.152.2/examples/js/loaders/GLTFLoader.js"></script>
    <style>
      body, html {
        margin: 0;
        overflow: hidden;
        font-family: sans-serif;
      }
      #recordControls {
        position: absolute;
        top: 10px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 10;
      }
      #recordControls button {
        padding: 10px 20px;
        font-size: 16px;
        margin: 0 5px;
        border-radius: 6px;
        border: none;
        background: #000;
        color: #fff;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <div id="recordControls">
      <button id="startRecord">⏺️ Start Record</button>
      <button id="stopRecord" disabled>⏹️ Stop & Save</button>
    </div>

    <mindar-image id="ar-viewer" image-target-src="targets.mind" auto-start="true" ui-loading="yes" ui-scanning="yes" ui-error="yes">
      <mindar-scene>
        <mindar-camera></mindar-camera>
        <mindar-image-target targetIndex="0">
          <a-entity
            gltf-model="AR.glb"
            scale="0.5 0.5 0.5"
            position="0 0 0"
            rotation="0 0 0"
          ></a-entity>
        </mindar-image-target>
      </mindar-scene>
    </mindar-image>

    <script>
      // Recorder setup
      let mediaRecorder;
      let recordedChunks = [];

      const startBtn = document.getElementById("startRecord");
      const stopBtn = document.getElementById("stopRecord");

      startBtn.onclick = () => {
        const canvas = document.querySelector("canvas");
        const stream = canvas.captureStream(30);
        mediaRecorder = new MediaRecorder(stream, { mimeType: "video/webm" });

        recordedChunks = [];
        mediaRecorder.ondataavailable = (e) => {
          if (e.data.size > 0) recordedChunks.push(e.data);
        };

        mediaRecorder.onstop = () => {
          const blob = new Blob(recordedChunks, { type: "video/webm" });
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = "recording.webm";
          a.click();
        };

        mediaRecorder.start();
        startBtn.disabled = true;
        stopBtn.disabled = false;
      };

      stopBtn.onclick = () => {
        mediaRecorder.stop();
        startBtn.disabled = false;
        stopBtn.disabled = true;
      };
    </script>
  </body>
</html>